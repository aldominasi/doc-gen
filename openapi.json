swagger: "2.0"
info:
  title: Skeduler
  version: 1.0.0
definitions: {}
paths:
  /auth/:
    post:
      description: Chiamata per effettuare il login e ricevere il token per effettuare
        le successive chiamate
      tags:
        - Utenti
      parameters:
        - name: body
          in: body
          schema:
            $schema: http://json-schema.org/draft-07/schema#
            type: object
            additionalProperties: false
            properties:
              username:
                type: string
              password:
                type: string
            required:
              - username
              - password
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: object
                properties:
                  token:
                    type: string
                  ruolo:
                    type: boolean
            required:
              - code
              - msg
  /confirmed/{shortLink}:
    get:
      description: API per la conferma al click del link
      tags:
        - Link di conferma
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                type: object
                properties:
                  logo:
                    type: string
                    description: Logo struttura in Base64
                  nomeStruttura:
                    type: string
                  message:
                    type: string
            required:
              - code
              - msg
  /roles/:
    get:
      description: I ruoli disponibili sono "ADMIN" (utente con tutti i privilegi) e
        "Amministratore" (che dispone dei permessi per creare gli eventi per una
        o più strutture)
      tags:
        - Ruoli
      parameters:
        - in: header
          name: authorization
          required: true
          type: string
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    nome:
                      type: string
                    descrizione:
                      type: string
                    superUser:
                      type: boolean
            required:
              - code
              - msg
  /sending/createRange:
    post:
      description: API per generare un nuovo EVENTO, periodico collegato ad un utente
        ed una struttura
      tags:
        - Sender
      parameters:
        - name: body
          in: body
          schema:
            $schema: http://json-schema.org/draft-07/schema#
            type: object
            properties:
              struttura:
                type: string
                description: Il codice della struttura a cui è legato l'evento
              codiceFiscale:
                type: string
                description: Codice Fiscale del paziente a cui è legato l'evento
              nome:
                type: string
                description: Nome del paziente a cui è legato l'evento
              cognome:
                type: string
                description: Cognome del paziente a cui è legato l'evento
              telefono:
                type: string
                description: Numero di telefono del paziente a cui è legato l'evento
              email:
                type: string
                description: E-mail del paziente a cui è legato l'evento
              actionType:
                type: string
                enum:
                  - NoAction
                  - Notification
                  - Questionary
                description: "Tipo di azione che si vuole ottenere dall'utente (NoAction:
                  nessuna, Notification: si invia un link per la conferma di
                  ricezione"
              descrizione:
                type: string
                description: Descrizione dell'evento
              idPrescrizione:
                type: string
                description: Campo opzionale
              dataInizio:
                type: string
                description: Giorno da cui deve partire lo scheduling
              giorniTotali:
                type: number
                description: Numero di giorni in cui mandare notifiche
              range:
                type: number
                description: Intervallo di giorni che deve trascorrere tra due notifiche
                  consecutive
              orari:
                type: array
                items:
                  type: string
                description: Array degli orari a cui mandare le notifiche
              boolEmail:
                type: boolean
                description: Campo che indica se l'e-mail è uno dei metodi d'invio
                default: false
              emailMessage:
                type: string
                description: Messaggio da mandare nell'e-mail
              emailSubject:
                type: string
                description: Oggetto dell'e-mail
              emailAttachments:
                type: array
                items:
                  type: object
                  properties:
                    fileName:
                      type: string
                    data:
                      type: string
                    fileType:
                      type: string
                      enum:
                        - pdf
                description: Array degli eventuali allegati dell'e-mail (in pdf)
              boolSms:
                type: boolean
                description: Campo che indica se l'SMS è uno dei metodi d'invio
                default: false
              smsMessage:
                type: string
                description: Messaggio da mandare nell'SMS
              delayBeforeNotification:
                type: number
                default: 0
                description: Tempo dopo il quale mandare una notifica dopo la mancata ricezione
                  (ancora non implementato
              callbackInvio:
                type: string
                description: Eventuale indirizzo a cui mandare una notifica oppure ciò che viene
                  inserito nel campo responseInvio all'atto dell'invio della
                  notifica
              responseInvio:
                type: object
                additionalProperties: true
                description: Corpo del messaggio inviato al callbackInvio
              callbackClick:
                type: string
                description: Eventuale indirizzo a cui mandare una notifica oppure ciò che viene
                  inserito nel campo responseClick all'atto del click al link da
                  parte del paziente
              responseClick:
                type: object
                additionalProperties: true
                description: Corpo del messaggio inviato al callbackClick
              callbackEliminazione:
                type: string
                description: Eventuale indirizzo a cui mandare una notifica oppure ciò che viene
                  inserito nel campo responseClick all'atto dell'eliminazione
                  del sender
              responseEliminazione:
                type: object
                additionalProperties: true
                description: Corpo del messaggio inviato al callbackEliminazione
            required:
              - struttura
              - codiceFiscale
              - dataInizio
              - giorniTotali
              - range
              - orari
        - in: header
          name: authorization
          required: false
          type: string
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: string
            required:
              - code
              - msg
  /sending/delete/{idSender}:
    delete:
      description: API per eliminare un sender
      tags:
        - Sender
      parameters:
        - type: string
          required: true
          in: path
          name: idSender
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: string
            required:
              - code
              - msg
  /sending/:
    get:
      description: API per ricevere gli eventi in un determinato intervallo di date
      tags:
        - Sender
      parameters:
        - type: string
          description: CF del paziente a cui è associato il sender
          required: false
          in: query
          name: codiceFiscale
        - type: string
          description: Data iniziale da includere nella ricerca
          required: false
          in: query
          name: dataInizio
        - type: string
          description: Data finale da includere nella ricerca
          required: false
          in: query
          name: dataFine
        - type: integer
          minimum: 0
          default: 0
          description: Offset e limit insieme servono per ricevere un certo numero di
            sender per ogni chiamata
          required: false
          in: query
          name: offset
        - type: integer
          minimum: 1
          default: 100
          description: Numero massimo di sender che si vuole ricevere
          required: false
          in: query
          name: limit
        - in: header
          name: authorization
          required: true
          type: string
        - in: header
          name: idStruttura
          required: false
          type: string
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: object
                properties:
                  totalRecords:
                    type: integer
                    description: Numero di sender inviati
                  records:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        codiceFiscale:
                          type: string
                          description: Codice Fiscale del paziente a cui è legato l'evento
                        nome:
                          type: string
                          description: Nome del paziente a cui è legato l'evento
                        cognome:
                          type: string
                          description: Cognome del paziente a cui è legato l'evento
                        telefono:
                          type: string
                          description: Numero di telefono del paziente a cui è legato l'evento
                        email:
                          type: string
                          description: E-mail del paziente a cui è legato l'evento
                        struttura:
                          type: object
                          properties:
                            id:
                              type: string
                            nome:
                              type: string
                            email:
                              type: string
                            logo:
                              type: string
                            colore:
                              type: string
                            boolSms:
                              type: boolean
                            boolEmail:
                              type: boolean
                            boolPush:
                              type: boolean
                            createdAt:
                              type: string
                            updatedAt:
                              type: string
                        creatore:
                          type: object
                          properties:
                            username:
                              type: string
                            password:
                              type: string
                            attivo:
                              type: boolean
                            createdAt:
                              type: string
                            updatedAt:
                              type: string
                        pending:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: integer
                                description: ID del pending click
                              numeroInvio:
                                type: string
                                description: Numero che indica l'ordine in cui vengono inviate le notifiche del
                                  sender corrente
                              sendMail:
                                type: boolean
                                description: Booleano che indica se l'invio della mail è stato effettuato
                              dataSendMail:
                                type: string
                                description: Data e orario in cui è stata mandata l'e-mail
                              sendSms:
                                type: boolean
                                description: Booleano che indica se l'invio del messaggio è stato effettuato
                              dataSendSms:
                                type: string
                                description: Data e orario in cui è stato mandato il messaggio
                              sendPush:
                                type: boolean
                                description: Booleano che indica se l'invio della notifica è stato effettuato
                              dataSendPush:
                                type: string
                                description: Data e orario in cui è stata mandata la notifica
                              click:
                                type: boolean
                                description: Booleano che indica se l'utente ha cliccato sul link di conferma
                              dataClick:
                                type: boolean
                                description: Non ancora implementato
                              giorno:
                                type: string
                                description: Data in cui verrà effettuato l'invio
                              orario:
                                type: string
                                description: Orario in cui verrà effettuato l'invio
                              shortLink:
                                type: string
                                description: Link da cliccare per inviare la notifica di ricezione
                              createdAt:
                                type: string
                              updatedAt:
                                type: string
                        actionType:
                          type: string
                          enum:
                            - NoAction
                            - Notification
                            - Questionary
                        descrizione:
                          type: string
                          description: Descrizione dell'evento
                        idPrescrizione:
                          type: string
                          description: Campo opzionale
                        dataInizio:
                          type: string
                          description: Giorno da cui deve partire lo scheduling
                        dataFine:
                          type: string
                          description: Data dell'ultimo invio (viene calcolata automaticamente)
                        giorniTotali:
                          type: string
                          description: Numero di giorni in cui mandare notifiche
                        range:
                          type: string
                          description: Intervallo di giorni che deve trascorrere tra due notifiche
                            consecutive
                        orari:
                          type: array
                          items:
                            type: string
                          description: Array degli orari a cui mandare le notifiche
                        boolEmail:
                          type: boolean
                          description: Campo che indica se l'e-mail è uno dei metodi d'invio
                          default: false
                        emailMessage:
                          type: string
                          description: Messaggio da mandare nell'e-mail
                        emailSubject:
                          type: string
                          description: Oggetto dell'e-mail
                        emailAttachments:
                          type: array
                          items:
                            type: object
                            properties:
                              fileName:
                                type: string
                              data:
                                type: string
                              fileType:
                                type: string
                                enum:
                                  - pdf
                          description: Array degli eventuali allegati dell'e-mail (in pdf)
                        boolSms:
                          type: boolean
                          description: Campo che indica se l'SMS è uno dei metodi d'invio
                          default: false
                        smsMessage:
                          type: string
                          description: Messaggio da mandare nell'SMS
                        boolPush:
                          type: boolean
                        pushMessage:
                          type: string
                        delayBeforeNotification:
                          type: number
                          default: 0
                          description: Tempo dopo il quale mandare una notifica dopo la mancata ricezione
                        callbackInvio:
                          type: string
                          description: Eventuale indirizzo a cui mandare una notifica oppure ciò che viene
                            inserito nel campo responseInvio all'atto dell'invio
                            della notifica
                        responseInvio:
                          type: object
                          additionalProperties: true
                          description: Corpo del messaggio inviato al callbackInvio
                        callbackClick:
                          type: string
                          description: Eventuale indirizzo a cui mandare una notifica oppure ciò che viene
                            inserito nel campo responseClick all'atto del click
                            al link da parte del paziente
                        responseClick:
                          type: object
                          additionalProperties: true
                          description: Corpo del messaggio inviato al callbackClick
                        callbackEliminazione:
                          type: string
                          description: Eventuale indirizzo a cui mandare una notifica oppure ciò che viene
                            inserito nel campo responseClick all'atto
                            dell'eliminazione del sender
                        responseEliminazione:
                          type: object
                          additionalProperties: true
                          description: Corpo del messaggio inviato al callbackEliminazione
                        eliminato:
                          type: boolean
                          description: Booleano che indica se il sender è stato eliminato
                        dataEliminazione:
                          type: string
                          description: Data in cui è stato eliminato il sender
                        createdAt:
                          type: string
                        updatedAt:
                          type: string
            required:
              - code
              - msg
  /sending/timeSlot:
    get:
      description: API per ricevere gli slotOrari selezionabili (ogni 15 minuti)
      tags:
        - Sender
      parameters:
        - in: header
          name: authorization
          required: true
          type: string
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: array
                items:
                  type: object
                  properties:
                    value:
                      type: string
                    label:
                      type: string
                    disabled:
                      type: boolean
            required:
              - code
              - msg
  /sending/getSenderType:
    get:
      description: "API per ricevere i tipi di Sender: NoAction, Notification o
        Questionary "
      tags:
        - Sender
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: array
                items:
                  type: string
            required:
              - code
              - msg
  /structures/:
    post:
      description: API per creare una nuova struttura, può essere effettuata solo da
        un utente ADMIN
      tags:
        - Strutture
      parameters:
        - name: body
          in: body
          schema:
            $schema: http://json-schema.org/draft-07/schema#
            type: object
            additionalProperties: false
            properties:
              idStruttura:
                type: string
                description: Codice identificativo della struttura
              name:
                type: string
                description: Nome della struttura
              mail:
                type: string
                description: E-mail di riferimento della struttura
              boolSms:
                type: boolean
                description: Campo che indica se la struttura è predisposta ad inviare messaggi
                  agli utenti
                default: false
              boolEmail:
                type: boolean
                description: Campo che indica se la struttura è predisposta ad inviare e-mail
                  agli utenti
                default: false
              boolPush:
                type: boolean
                description: Campo che indica se la struttura è predisposta ad inviare notifiche
                  push agli utenti
                default: false
              logo:
                type: string
                description: Logo della struttura (in base64)
              colore:
                type: string
                description: Colore da associare alla struttura
            required:
              - idStruttura
              - name
              - mail
      responses:
        "201":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: string
            required:
              - code
              - msg
    get:
      description: API per ricevere la lista delle strutture inserite nel sistema
      tags:
        - Strutture
      parameters:
        - type: integer
          minimum: 0
          required: false
          in: query
          name: offset
        - type: integer
          maximum: 100
          required: false
          in: query
          name: limit
        - type: string
          maxLength: 50
          default: ""
          required: false
          in: query
          name: search
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: object
                properties:
                  totalRecords:
                    type: integer
                  records:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: Codice identificativo della struttura
                        nome:
                          type: string
                          description: Nome della struttura
                        email:
                          type: string
                          description: E-mail di riferimento della struttura
                        logo:
                          type: string
                          description: Logo della struttura (in base64)
                        colore:
                          type: string
                          description: Colore da associare alla struttura
                        boolSms:
                          type: boolean
                          description: Campo che indica se la struttura è predisposta ad inviare messaggi
                            agli utenti
                        boolEmail:
                          type: boolean
                          description: Campo che indica se la struttura è predisposta ad inviare e-mail
                            agli utenti
                        boolPush:
                          type: boolean
                          description: Campo che indica se la struttura è predisposta ad inviare notifiche
                            push agli utenti
            required:
              - code
              - msg
  /structures/delete/{idStructure}:
    delete:
      description: API per eliminare una struttura, può essere effettuata solo da un
        utente ADMIN
      tags:
        - Strutture
      parameters:
        - type: string
          required: true
          in: path
          name: idStructure
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: string
            required:
              - code
              - msg
  /structures/update/{idStructure}:
    patch:
      description: API per aggiornare una struttura, può essere effettuata solo da un
        utente ADMIN
      tags:
        - Strutture
      parameters:
        - name: body
          in: body
          schema:
            $schema: http://json-schema.org/draft-07/schema#
            type: object
            additionalProperties: false
            properties:
              name:
                type: string
                minLength: 1
                description: Nome della struttura
              mail:
                type: string
                minLength: 1
                description: E-mail di riferimento della struttura
              boolSms:
                type: boolean
                description: Campo che indica se la struttura è predisposta ad inviare messaggi
                  agli utenti
                default: false
              boolEmail:
                type: boolean
                description: Campo che indica se la struttura è predisposta ad inviare e-mail
                  agli utenti
                default: false
              boolPush:
                type: boolean
                description: Campo che indica se la struttura è predisposta ad inviare notifiche
                  push agli utenti
                default: false
              logo:
                type: string
                description: Logo della struttura (in base64)
              colore:
                type: string
                description: Colore da associare alla struttura
            required:
              - name
              - mail
        - type: string
          required: true
          in: path
          name: idStructure
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: string
            required:
              - code
              - msg
  /users/changePwd:
    patch:
      description: API utilizzata per il cambio password
      tags:
        - Utenti
      parameters:
        - name: body
          in: body
          schema:
            $schema: http://json-schema.org/draft-07/schema#
            type: object
            additionalProperties: false
            properties:
              oldPassword:
                type: string
              newPassword:
                type: string
            required:
              - oldPassword
              - newPassword
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                type: string
            required:
              - code
              - msg
  /users/:
    patch:
      description: API utilizzata dal un ADMIN per attivare o disattivare un utenza
      tags:
        - Utenti
      parameters:
        - name: body
          in: body
          schema:
            $schema: http://json-schema.org/draft-07/schema#
            type: array
            items:
              type: object
              properties:
                username:
                  type: string
                attivo:
                  type: boolean
              required:
                - username
                - attivo
            minItems: 1
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                type: string
            required:
              - code
              - msg
    post:
      description: API utilizzata per creare un nuovo utente,  può essere eseguita
        solo da un ADMIN
      tags:
        - Utenti
      parameters:
        - name: body
          in: body
          schema:
            $schema: http://json-schema.org/draft-07/schema#
            type: object
            additionalProperties: false
            properties:
              username:
                type: string
                description: Username per l'accesso
              password:
                type: string
                description: Password per l'accesso, deve contenere almeno 8 caratteri e un
                  numero
              strutture:
                type: array
                items:
                  type: string
                description: Array delle strutture associate all'utente
              ruolo:
                type: number
                description: "Ruolo dell'utente: 1 per permessi amministratore, 2 altrimenti"
            required:
              - username
              - password
              - ruolo
      responses:
        "201":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: string
            required:
              - code
              - msg
    get:
      description: API utilizzata per ottenere la lista degli utenti
      tags:
        - Utenti
      parameters:
        - type: integer
          minimum: 0
          required: false
          in: query
          name: offset
        - type: integer
          maximum: 100
          required: false
          in: query
          name: limit
        - type: string
          maxLength: 50
          default: ""
          required: false
          in: query
          name: search
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: object
                properties:
                  totalRecords:
                    type: integer
                  records:
                    type: array
                    items:
                      type: object
                      properties:
                        username:
                          type: string
                        attivo:
                          type: boolean
                        createdAt:
                          type: string
                        updatedAt:
                          type: string
                        strutture:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: string
                              nome:
                                type: string
                              email:
                                type: string
                              logo:
                                type: string
                              colore:
                                type: string
                              boolSms:
                                type: boolean
                              boolEmail:
                                type: boolean
                              boolPush:
                                type: boolean
                        ruolo:
                          type: object
                          properties:
                            id:
                              type: number
                            nome:
                              type: string
                            descrizione:
                              type: string
                            superUser:
                              type: boolean
                            createdAt:
                              type: string
                            updatedAt:
                              type: string
            required:
              - code
              - msg
  /users/{username}:
    delete:
      description: API per eliminare un utenza, può essere eseguita solo da un ADMIN
      tags:
        - Utenti
      parameters:
        - type: string
          required: true
          in: path
          name: username
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                nullable: true
                type: string
            required:
              - code
              - msg
  /users/updateUser:
    patch:
      description: API utilizzata per modificare i dati di un utente
      tags:
        - Utenti
      parameters:
        - name: body
          in: body
          schema:
            $schema: http://json-schema.org/draft-07/schema#
            type: object
            additionalProperties: false
            properties:
              username:
                type: string
              password:
                type: string
              attivo:
                type: boolean
              strutture:
                nullable: true
                type: array
                items:
                  type: string
              ruolo:
                type: number
            required:
              - username
        - in: header
          name: authorization
          required: true
          type: string
      responses:
        "200":
          description: Default Response
          schema:
            type: object
            properties:
              error:
                type: boolean
                default: false
              code:
                type: string
                default: ""
              msg:
                type: string
                default: ok
              data:
                type: string
            required:
              - code
              - msg
tags:
  - name: Utenti
    description: Gestione degli utenti
  - name: Sender
    description: Gestione degli invii
  - name: Strutture
    description: Gestione delle strutture
  - name: Link di conferma
    description: Link di conferma
  - name: Ruoli
    description: Gestione dei ruoli
